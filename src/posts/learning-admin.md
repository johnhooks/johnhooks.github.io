---
title: Learning Server Admin
seoTitle: Learning Server Admin for Hosting Multiple Websites on a Single VPS
slug: learning-admin
abstract: My journey to run multiple websites on a single VPS using Caddy
isPublished: true
publishedOn: 2022-09-21
---

### Initial Server Setup

1. [Initial Server Setup with Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04)
2. [How To Set Up a Firewall with UFW on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04)
3. [How To Harden OpenSSH on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-harden-openssh-on-ubuntu-18-04)
4. [How To Install Node.js on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04)
5. [How To Set Up a Node.js Application for Production on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-18-04)

#### Server Additional Reading

- [How to Set Up SSH Keys on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1804)
- [Systemd Essentials: Working with Services, Units, and the Journal](https://www.digitalocean.com/community/tutorials/systemd-essentials-working-with-services-units-and-the-journal)

### Server Maintenance

- [How To View and Configure Linux Logs on Ubuntu and Centos](https://www.digitalocean.com/community/tutorials/how-to-view-and-configure-linux-logs-on-ubuntu-and-centos)

### DNS

- [Managing DNS records in Cloudflare](https://support.cloudflare.com/hc/en-us/articles/360019093151-Managing-DNS-records-in-Cloudflare)
- [Domains and DNS](https://docs.digitalocean.com/products/networking/dns/)

### Caddy

#### Setup

1. [How To Install Go and Set Up a Local Programming Environment on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-install-go-and-set-up-a-local-programming-environment-on-ubuntu-18-04)
2. [How To Host a Website with Caddy on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-host-a-website-with-caddy-on-ubuntu-18-04)
3. [Cloudflare module for Caddy](https://github.com/caddy-dns/cloudflare)

#### Caddyfile

```
example.com, www.example.com {
    reverse_proxy 127.0.0.1:3000
    encode gzip

    log {
        output stderr
        format console
        level PANIC
    }

    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}
```

The CF_API_TOKEN is located in the /etc/systemd/system/caddy.service

```
...
[Service]
User=caddy
Group=caddy
Environment=CF_API_TOKEN={your_token_here}
ExecStart=/usr/bin/caddy run --environ --config /etc/caddy/Caddyfile
ExecReload=/usr/bin/caddy reload --config /etc/caddy/Caddyfile
TimeoutStopSec=5s
LimitNOFILE=1048576
LimitNPROC=512
PrivateTmp=true
ProtectSystem=full
AmbientCapabilities=CAP_NET_BIND_SERVICE
...
```

### Node.js

#### Installing Using a PPA

Download the installation script.

```shell
cd ~
curl -sL https://deb.nodesource.com/setup_16.x -o nodesource_setup.sh
```

You can inspect the contents of the script.

```shell
nano nodesource_setup.sh
```

Run the script to install the NodeSource PPA.

```shell
sudo bash nodesource_setup.sh
```

Install Node.js with the package manager.

```shell
sudo apt install nodejs
```

Check that it was installed.

```shell
node -v
```

`npm` was also installed.

Because some `npm` packages will require compiling code from source, the `build-essential` package should also be installed.

```shell
sudo apt install build-essential
```

### PM2

#### PM2 Setup

1. `pm2 start ecosystem.config.js`
2. `pm2 save`
3. run the command generated by `pm2 startup systemd`
4. inspect the generated unit file `less /etc/systemd/system/pm2-{user_name}.service`
5. `sudo systemctl enable pm2-{user_name}`
6. `sudo systemctl start pm2-{user_name}`
7. `systemctl status pm2-{user_name}`

#### Changing PM2 Configuration After startup

```shell
pm2 startOrReload ecosystem.config.js --update-env
```

This may have resolved the below issue. Just make sure the run `pm2 save` afterwards. https://stackoverflow.com/q/44508316

I had a lot of trouble changing the configuration of PM2. Before the changes in the `ecosystem.config.js`
would be recognized I had to do the following:

1. `pm2 stop all`
2. `pm2 delete all`
3. remove the previously saved configuration `pm2 cleardump`
4. `sudo systemctl stop pm2-<USERNAME>`
5. remove the pm2 service by running the command generated by `pm2 unstartup systemd`
6. `sudo systemctl daemon-reload`
7. `sudo systemctl reboot` restart the server
8. [Then follow the setup steps](#pm2-setup)

### systemd

- [How To Use Systemctl to Manage Systemd Services and Units](https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units)

### Users

- `deploy`
- `app`

### VSCode Remote

- [sucode](https://github.com/microsoft/vscode/issues/48659#issuecomment-825328802)
- [copy](https://github.com/microsoft/vscode/issues/48659#issuecomment-871085291)
